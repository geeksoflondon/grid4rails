<div id="slot-<%= @slot.id %>" class="slot">
    <%
        if (@slot.is_empty?)
            @empty_slot_index += 1
        end
        slot_index = @slots.index(@slot)
    %>
    <% if (@version == "low" && @page_id != "room") %>              
        <%
            # Determine the id of the next slot in the current timeslot
            if (@slot != @slots.last)
                slot_next_id = @slots[slot_index + 1].id
            elsif (@timeslot != @timeslots.last)
                slot_next_id = @timeslots[@timeslots.index(@timeslot) + 1].slots.first.id
            else
                slot_next_id = nil
            end

            # Determine the id of the previous slot in the current timeslot
            if (@slot != @slots.first)
                slot_prev_id = @slots[slot_index - 1].id
            elsif (@timeslot != @timeslots.first)
                slot_prev_id = @timeslots[@timeslots.index(@timeslot) - 1].slots.first.id
            else
                slot_prev_id = nil
            end
        %>
                
        <p class="skip skip-to-talk">
            <span class="label">Talk: </span>           
            <% if (!slot_next_id.nil?) %>
                <a href="#slot-<%= slot_next_id %>">next</a>
            <% end %>
            <% if (!slot_next_id.nil? && !slot_prev_id.nil?) %>
                <span class="delimiter"> | </span>
            <% end %>
            <% if (!slot_prev_id.nil?) %>
                <a href="#slot-<%= slot_prev_id %>">prev</a>
            <% end %>
            <span class="delimiter"> | </span>
            <a href="#header" class="top">top</a>
        </p>            
    <% end %>   
    <% if (@slot.is_empty?) %>              
        <div id="empty-<%= @empty_slot_index %>" class="empty">    
            <% if (@page_id != "room") %>    
                <% cache("where_when_#{@slot.id}") do %>
                    <%= render '/shared/grid/where_when' %>
                <% end %>
            <% end %>
            <% if (@page_id == "talk-assign" || @page_id == "talk-move") %>
                <%= form_tag(:controller => "talks", :action => "assign_slot") do |f| %>
                    <input type="hidden" name="slot" value="<%= @slot.id %>" />
                    <% if (@page_id == "talk-assign") %>
                        <p class="actions"><span class="submit"><%= submit_tag("Insert here", options = { :class => "button green medium" }) %></span></p>
                    <% else %>
                        <p class="actions"><span class="submit"><%= submit_tag("Move here", options = { :class => "button green medium" }) %></span></p>
                    <% end %>
                <% end %>
            <% else %>
                <p class="actions">
                    <span class='submit'><%= link_to("Add a talk", url_options = { :controller => "talks", :action => "new"}, html_options = { :class => "button green medium" }) %></span>
                </p> 
            <% end %>
            <% if (@version == "low" && @page_id != "room") %>   
                <p class="skip skip-to-empty">
                    <span class="label">Empty: </span>
                    <a href="#empty-<%= (@empty_slot_index + 1) %>">next</a>
                    <span class="delimiter"> | </span>
                    <a href="#empty-<%= (@empty_slot_index - 1) %>">prev</a>
                    <span class="delimiter"> | </span>
                    <a href="#header" class="top">top</a>
                </p>
            <% end %>
        </div>  
    <% else %>
        <% talk = @slot.talk %>
        <div class="talk">
            <% if (@page_id != "room") %>
                <%= render '/shared/grid/where_when' unless @slot.locked %>
            <% end %>
            <% if (@page_id == "talk-move" unless (@slot.locked? || talk == @unscheduled)) %>
                <%= form_tag(:controller => "talks", :action => "swap_slot") do |f| %>
                    <input type="hidden" name="talk_2" value="<%= talk.id %>" />
                    <p class="actions"><span class="submit"><%= submit_tag("Swap", :class => "button orange medium") %></span></p>
                <% end %>
            <% end %>           
            <h2 class="heading title">
                <% talk_title = ((talk.title.strip == "") ? "[Untitled]" : talk.title) %>
                <%= link_to talk_title, talk_path(talk) unless talk.title.nil? %>                    
            </h2> 
            <% if ((!talk.speaker.nil?) && talk.speaker.strip != "") %>
                <h3 class="heading speaker">
                    <%= talk.speaker %>
                </h3>
            <% end %>          
        </div>       
    <% end %>
</div>